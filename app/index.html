<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Messages</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' https://unpkg.com; connect-src * ws: wss:; img-src 'self' data:;"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
  .msg-menu {
    position: absolute; z-index: 9999;
    background: #fff; color:#111;
    border: 1px solid #e5e7eb; border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,.08);
    padding: 6px; min-width: 140px; display: none;
  }
  .msg-menu.open { display: block; }
  .msg-menu button {
    display:block; width:100%; text-align:left;
    background:transparent; border:0; padding:8px 10px; border-radius:8px; cursor:pointer;
    font: inherit; color: inherit;
  }
  .msg-menu button:hover { background:#f5f5f7; }
    :root{
      --bg:#f5f5f7; --panel:#ffffff; --text:#111; --muted:#6b7280;
      --me:#0b84ff; --me-text:#fff; --them:#e9e9eb; --them-text:#111;
      --bar:#f8f8fb; --border:#e5e7eb; --accent:#0b84ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{font:16px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text);background:var(--bg);}
    .app{display:flex;flex-direction:column; height:100%;}
    .top{position:sticky;top:0;z-index:10;background:var(--bar);border-bottom:1px solid var(--border);}
    .top-inner{max-width:900px;margin:0 auto;padding:10px 12px;display:flex;align-items:center;gap:8px}
    .title{font-weight:600;margin-right:auto}
    .status{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:14px}
    .dot{width:8px;height:8px;border-radius:50%;background:#bbb}
    .dot.on{background:#10b981}
    .controls{max-width:900px;margin:0 auto;padding:8px 12px;display:grid;grid-template-columns:1fr 1.2fr .7fr auto; gap:8px; border-top:1px solid var(--border); background:var(--panel)}
    .controls input{padding:10px;border:1px solid var(--border);border-radius:10px}
    .controls button{padding:10px 14px;border:1px solid var(--accent);background:var(--accent);color:#fff;border-radius:10px;cursor:pointer}
    .controls button.secondary{background:#fff;color:var(--accent)}
    .hidden{display:none !important;}
    .wrap{max-width:900px;margin:0 auto;flex:1; display:flex; flex-direction:column;}
    .msgs{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:10px}
    .row{display:flex; gap:8px; align-items:flex-end}
    .row.me{justify-content:flex-end}
    .bubble{
      max-width:min(72%, 560px);
      padding:10px 12px;border-radius:18px; line-height:1.35; word-wrap:break-word; white-space:pre-wrap;
      position:relative;
    }
    .me .bubble{background:var(--me);color:var(--me-text); border-bottom-right-radius:6px}
    .them .bubble{background:var(--them);color:var(--them-text); border-bottom-left-radius:6px}
    .meta{font-size:12px;color:var(--muted); margin:0 6px}
    .inputbar{padding:10px 12px; border-top:1px solid var(--border); background:var(--panel); display:flex; gap:8px}
    .inputbar textarea{flex:1; resize:none; max-height:140px; min-height:42px; padding:10px 12px;border:1px solid var(--border);border-radius:20px; outline:none}
    .send{padding:10px 16px;border:none;background:var(--accent);color:#fff;border-radius:18px;cursor:pointer}
    .badge{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--border);color:var(--muted)}
    @media (max-width:700px){ .controls{grid-template-columns:1fr;} }
  </style>
</head>
<body>
<div class="app">
  <div class="top">
    <div class="top-inner">
      <div class="title">Messages</div>
      <div class="status"><span id="statusDot" class="dot"></span><span id="statusText">Disconnected</span></div>
      <button id="toggleCfg" class="badge" title="Show/Hide connection settings">Settings</button>
    </div>
    <div id="cfg" class="controls">
      <input id="room" placeholder="Room" value="demo-room-1"/>
      <input id="signalUrl" placeholder="wss://signal.unchaine.com" value="wss://signal.unchaine.com"/>
      <input id="turn" placeholder="TURN (optional): turn:turn.yourdomain.com:3478"/>
      <button id="joinBtn">Join</button>
      <button id="leaveBtn" class="secondary">Leave</button>
    </div>
    <div style="display:flex; gap:8px; margin-top:8px;">
      <button id="createInviteBtn">Create Invite</button>
      <input id="inviteLink" placeholder="Invite link" style="flex:1;">
      <button id="copyInviteBtn">Copy</button>
    </div>
    <!-- OPTIONAL: a field to paste an invite link/token manually -->
    <div style="display:flex; gap:8px; margin-top:8px;">
      <input id="pasteInvite" placeholder="Paste invite link or token">
      <button id="useInviteBtn">Use Invite</button>
    </div>
  </div>

  <div class="wrap">
    <div id="msgs" class="msgs"></div>
    <div class="inputbar">
      <textarea id="msg" placeholder="Send a message"></textarea>
      <button id="sendBtn" class="send">Send</button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/simple-peer@9.11.1/simplepeer.min.js"></script>
<script src="./renderer.js"></script>
</body>
</html>
